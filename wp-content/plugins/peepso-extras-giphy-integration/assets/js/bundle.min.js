!function o(r,a,p){function h(e,t){if(!a[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var n=a[e]={exports:{}};r[e][0].call(n.exports,function(t){return h(r[e][1][t]||t)},n,n.exports,o,r,a,p)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<p.length;t++)h(p[t]);return h}({1:[function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n,o,r;n=window,r=function(t,h,r){return peepso.createClass(t,{__constructor:function t(){this.template=peepsogiphydata.dialogGiphyTemplate;peepso.observer.addFilter("comment_show_button",this.shouldShowButton,10,1);peepso.observer.addFilter("comment_can_submit",this.isSubmittable,10,1);peepso.observer.addFilter("comment_req",this.filterRequest,10,2);peepso.observer.addAction("comment_edit",this.onEdit,10,2);h(h.proxy(this.onDocumentLoaded,this))},onDocumentLoaded:function t(){h(document).on("click",".ps-js-comment-giphy",h.proxy(this.onAttach,this));h(document).on("click",".ps-js-addon-giphy .ps-js-remove",h.proxy(this.onRemove,this));h(document).on("ps_comment_aftersave",h.proxy(this.onSaved,this))},onAttach:_.throttle(function(t){var e="ps-giphy-initialized",i="ps-giphy-loading",s=peepso.rtl,n=h(t.currentTarget),o,r;t.preventDefault();t.stopPropagation();o=n.closest(".ps-js-comment-new, .ps-js-comment-edit");r=o.prev(".ps-js-giphy-container");if(!r.length){r=h(this.template);r.data("act-id",o.data("id"));r.find(".ps-js-giphy-list").css("transition","margin-".concat(s?"right":"left"," .5s"));r.hide().insertBefore(o);r.on("input",".ps-js-giphy-query",h.proxy(this.onSearch,this));r.on("click",".ps-js-giphy-list img",h.proxy(this.onSelectImage,this));r.on("click",".ps-js-giphy-nav-left","left",h.proxy(this.onNavigate,this));r.on("click",".ps-js-giphy-nav-right","right",h.proxy(this.onNavigate,this))}if(r.is(":visible")){r.hide();return}r.show();if(r.data(e)||r.data(i)){return}r.data(i,true);this.search(r).done(h.proxy(function(){r.find(".ps-js-giphy-query").show();r.data(e,true);r.removeData(i)},this))},1e3),search:function t(n,o){return h.Deferred(h.proxy(function(e){var t=r.getInstance(),i=n.find(".ps-js-giphy-loading").show(),s=n.find(".ps-js-giphy-list").hide();t.search(o).done(h.proxy(function(t){this.render(n,t);i.hide();s.show();e.resolveWith(this)},this))},this))},render:function t(e,i){var s=e.find(".ps-js-giphy-list"),n=e.find(".ps-js-giphy-list-item"),o=peepso.template(n.html()),r=peepsogiphydata.giphy_rendition_comments||"fixed_width",a;a=_.map(i,function(t,e){if(t.images[r]){h.extend(t,{src:t.images[r].url,preview:t.images.preview_gif.url})}return o(t)});s.html(a.join(""))},onSearch:function t(e){var i=h(e.currentTarget),s=i.closest(".ps-js-giphy-container"),n=s.find(".ps-js-giphy-list"),o=s.find(".ps-js-giphy-loading"),r=peepso.rtl;n.hide().css(r?"marginRight":"marginLeft",0);o.show();this._onSearch(s,i)},_onSearch:_.debounce(function(t,e){this.search(t,h.trim(e.val()))},1e3),onNavigate:_.throttle(function(t){var e=h(t.currentTarget),i=e.parent(),s=e.siblings(".ps-js-giphy-list"),n=i.width(),o=peepso.rtl,r=parseInt(s.css(o?"marginRight":"marginLeft"))||0,a,p;if(t.data===(o?"right":"left")){r=r+n;r=Math.min(r,0)}else if(t.data===(o?"left":"right")){a=s.children("span").last();if(o){p=Math.abs(a.position().left)}else{p=a.position().left+a.width()-n}r=r-Math.min(n,p)}s.css(o?"marginRight":"marginLeft",r)},500),onSelectImage:function t(e){var i=h(e.currentTarget),s=i.closest(".ps-js-giphy-container"),n=i.attr("src"),o=i.attr("data-url");this.select(s,n,o);s.hide()},select:function t(e,i,s){var n=e.siblings(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addons"),o=n.find(".ps-js-addon-giphy");o.find(".ps-js-remove").show();o.find(".ps-js-img").attr("src",i).attr("data-url",s).show();o.show();h(document).trigger("ps_comment_addon_added",o)},onRemove:function t(e){var i=h(e.currentTarget).closest(".ps-js-addon-giphy");i.find(".ps-js-remove").hide();i.find(".ps-js-img").attr("src","").attr("data-url","").hide();i.hide();h(document).trigger("ps_comment_addon_removed",i)},shouldShowButton:function t(e){var i=h(e.el).closest(".ps-js-comment-new, .ps-js-comment-edit"),s=i.find(".ps-js-addon-giphy"),n;if(s.is(":visible")){n=s.find(".ps-js-img");if(n.length&&n.attr("src")){e.show=true}}return e},isSubmittable:function t(e){var i=h(e.el).closest(".ps-js-comment-new, .ps-js-comment-edit"),s=i.find(".ps-js-addon-giphy"),n;if(s.is(":visible")){n=s.find(".ps-js-img");if(n.length&&n.attr("src")){e.can_submit=true}}return e},filterRequest:function t(e,i){var s=h(i).closest(".ps-js-comment-new, .ps-js-comment-edit"),n=s.find(".ps-js-addon-giphy"),o;if(n.is(":visible")){o=n.find(".ps-js-img");if(o.length&&o.attr("data-url")){e.giphy=o.attr("data-url");e.giphy=e.giphy.replace(/^[a-z]+:\/\//i,"")}}return e},onSaved:function t(e,i,s){var n=h(s).closest(".ps-js-comment-new, .ps-js-comment-edit"),o=n.find(".ps-js-addon-giphy");o.find(".ps-js-remove").hide();o.find(".ps-js-img").attr("src","").hide();o.hide();h(document).trigger("ps_comment_addon_removed",o)},onEdit:function t(e,i){var s=h(i),n=s.find(".ps-js-addon-giphy"),o=n.find(".ps-js-img");if(o.length&&o.attr("src")){n.find(".ps-js-remove").show();n.find(".ps-js-img").show();n.show();h(document).trigger("ps_comment_addon_added",n)}else{n.find(".ps-js-remove").hide();n.find(".ps-js-img").hide();n.hide();h(document).trigger("ps_comment_addon_removed",n)}}})}(o="PsGiphyComment",n.jQuery,t("./giphy.js")),"object"===(void 0===e?"undefined":s(e))&&e.exports?e.exports=r:n[o]=r,new r},{"./giphy.js":2}],2:[function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n,o,r,a;n=window,r=function(t,n){return peepso.createClass(t,{__constructor:function t(){this.apiKey=peepsogiphydata.giphy_api_key;this.displayLimit=peepsogiphydata.giphy_display_limit;this.rating=peepsogiphydata.giphy_rating},search:function t(i){i=n.trim(i||"");return n.Deferred(n.proxy(function(e){this._result||(this._result={});var t=this._result[i];if(t){e.resolveWith(this,[t]);return}this._giphy(i).done(n.proxy(function(t){this._result[i]=t.data;e.resolveWith(this,[t.data])},this))},this))},_giphy:function t(e){var i="https://api.giphy.com/v1/gifs/trending",s={api_key:this.apiKey,limit:this.displayLimit};if(this.rating){s.rating=this.rating}if(e){i="https://api.giphy.com/v1/gifs/search";s=_.extend(s,{q:e,offset:0})}return n.get(i,s)}})}(o="PsGiphy",n.jQuery),a={getInstance:function(){return this._instance||(this._instance=new r),this._instance}},"object"===(void 0===e?"undefined":s(e))&&e.exports?e.exports=a:n[o]=a},{}],3:[function(s,t,e){(function(t){"use strict";var e,n=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},i="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null;s("./comment"),s("./message"),s("./postbox"),i.observer.addFilter("human_friendly_extras",function(t,e,i){if(!e&&i&&!i.querySelector(".ps-stream-header")){var s=(0,n.default)(i).find(".ps-comment-media .ps-js-giphy [data-preview]");s.length&&t.push(s.data("preview"))}return t},20,3)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./comment":1,"./message":4,"./postbox":5}],4:[function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n,o,r;n=window,r=function(t,p,r){return peepso.createClass(t,{__constructor:function t(){p(p.proxy(this.onDocumentLoaded,this))},onDocumentLoaded:function t(){p(document).on("click",".ps-chat-window .ps-js-giphy-trigger",p.proxy(this.onToggle,this))},onToggle:function t(e){var i=p(e.currentTarget),s=i.siblings(".ps-js-giphy-container"),n="ps-giphy-initialized",o="ps-giphy-loading",r,a;e.preventDefault();e.stopPropagation();if(s.is(":visible")){s.hide();return}s.show();if(s.data(n)||s.data(o)){return}s.data(o,true);s.on("input",".ps-js-giphy-query",p.proxy(this.onSearch,this));s.on("click",".ps-js-giphy-list img",p.proxy(this.onSelectImage,this));this.search(s).done(p.proxy(function(){s.find(".ps-js-giphy-query").show();s.data(n,true);s.removeData(o)},this))},search:function t(n,o){return p.Deferred(p.proxy(function(e){var t=r.getInstance(),i=n.find(".ps-js-giphy-loading").show(),s=n.find(".ps-js-giphy-list").hide();t.search(o).done(p.proxy(function(t){this.render(n,t);i.hide();s.show();e.resolveWith(this)},this))},this))},render:function t(e,i){var s=e.find(".ps-js-giphy-list"),n=e.find(".ps-js-giphy-list-item"),o=peepso.template(n.html()),r=peepsogiphydata.giphy_rendition_messages||"fixed_width",a;a=_.map(i,function(t,e){if(t.images[r]){p.extend(t,{src:t.images[r].url,preview:t.images.preview_gif.url})}return o(t)});s.html(a.join(""))},onSearch:function t(e){var i=p(e.currentTarget),s=i.closest(".ps-js-giphy-container"),n=s.find(".ps-js-giphy-list"),o=s.find(".ps-js-giphy-loading");n.hide();o.show();this._onSearch(s,i)},_onSearch:_.debounce(function(t,e){this.search(t,p.trim(e.val()))},1e3),onSelectImage:function t(e){var i=p(e.currentTarget),s=i.closest(".ps-js-giphy-container"),n=s.closest(".ps-chat-window").data("id"),o=i.attr("data-url");s.hide();this.post(n,o)},post:function t(e,i){peepso.observer.doAction("msgso_send_message",e,"",{type:"giphy",giphy:i})}})}(o="PsGiphyMessage",n.jQuery,t("./giphy.js")),"object"===(void 0===e?"undefined":s(e))&&e.exports?e.exports=r:n[o]=r,new r},{"./giphy.js":2}],5:[function(c,t,e){(function(t){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s=i("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),n=i("undefined"!=typeof window?window._:void 0!==t?t._:null),a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=p();if(e&&e.has(t))return e.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=s?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}i.default=t,e&&e.set(t,i);return i}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),e=i(c("./giphy"));function p(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return p=function(){return t},t}function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var h=function(){function i(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.$postbox=t,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxGiphy=this.$postbox.find(".ps-postbox-tabs [data-tab-id=giphy]"),this.$preview=this.$postboxGiphy.find(".ps-js-giphy-preview").hide(),this.$selector=this.$postboxGiphy.find(".ps-js-giphy-selector"),this.$loading=this.$selector.find(".ps-js-giphy-loading"),this.$query=this.$selector.find(".ps-js-giphy-query"),this.$result=this.$selector.find(".ps-js-giphy-list"),this.$slider=this.$result.parent(),this.onScroll=n.default.throttle(this.onScroll,500),this.$preview.on("click",".ps-js-giphy-change",function(t){return e.onChangeImage(t)}),this.$query.on("input",function(t){return e.onInput(t)}),this.$result.on("click","img",function(t){return e.onSelect(t.target)}),this.$slider.find(".ps-js-giphy-nav-left").on("click",function(){return e.onScroll("left")}),this.$slider.find(".ps-js-giphy-nav-right").on("click",function(){return e.onScroll("right")}),this.giphy=null,this.itemTemplate=a.default.template(this.$slider.find(".ps-js-giphy-list-item").html()),this.$postboxTab.on("peepso_posttabs_show-giphy",s.default.proxy(this.show,this)),this.$postboxTab.on("peepso_posttabs_cancel-giphy",s.default.proxy(this.cancel,this)),this.$postboxTab.on("peepso_posttabs_submit-giphy",s.default.proxy(this.post,this)),a.observer.addAction("postbox_type_set",s.default.proxy(this.actionPostboxTypeSet,this),10,2),a.observer.addFilter("peepso_postbox_can_submit",s.default.proxy(this.filterCanSubmit,this),10,2)}return function(t,e,i){e&&o(t.prototype,e),i&&o(t,i)}(i,[{key:"show",value:function(){this.$postboxStatus.show(),this.$postboxGiphy.show(),this.giphy||(this.giphy=e.default.getInstance(),this.search())}},{key:"cancel",value:function(){this.selectedImage=null,this.$postboxGiphy.hide(),this.$preview.hide(),this.$selector.show(),this.$postbox.on_change()}},{key:"post",value:function(){var t="postbox_req_"+this.$postbox.guid;a.observer.addFilter(t,this.filterPostboxReq,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(t,this.filterPostboxReq,10)}},{key:"value",value:function(){var t;return this.selectedImage&&(t=this.selectedImage),t}},{key:"search",value:function(t){var e=this,i=0<arguments.length&&void 0!==t?t:"";this.$result.hide(),this.$loading.show(),clearTimeout(this.searchDelay);var s=this.searchDelay=setTimeout(function(){e.giphy.search(i).done(function(t){e.searchDelay===s&&(e.render(t),e.$loading.hide(),e.$result.show(),e.$query.show())})},1e3)}},{key:"render",value:function(t){var e=this,i=peepsogiphydata.giphy_rendition_comments||"fixed_width",s=t.map(function(t){return t.images[i]&&(t.src=t.images[i].url,t.preview=t.images.preview_gif.url),e.itemTemplate(t)});this.$result.html(s.join(""))}},{key:"select",value:function(t,e){this.selectedImage=e,this.$selector.hide(),this.$preview.find("img").attr("src",t),this.$preview.show(),this.$postbox.on_change()}},{key:"scroll",value:function(t){var e,i=a.default.rtl,s=this.$slider.width(),n=parseInt(this.$result.css(i?"marginRight":"marginLeft"))||0;if(t===(i?"right":"left"))n=Math.min(n+s,0);else if(t===(i?"left":"right")){var o=this.$result.children("span").last();e=i?Math.abs(o.position().left):o.position().left+o.width()-s,n-=Math.min(s,e)}this.$result.css(i?"marginRight":"marginLeft",n)}},{key:"onChangeImage",value:function(t){t.preventDefault(),t.stopPropagation(),this.selectedImage=null,this.$postbox.on_change(),this.$preview.hide(),this.$selector.show()}},{key:"onInput",value:function(t){var e=t.target.value;this.$result.hide(),this.$loading.show(),this.search(e.trim())}},{key:"onScroll",value:function(t){this.scroll(t)}},{key:"onSelect",value:function(t){this.select(t.src,t.getAttribute("data-url"))}},{key:"filterPostboxReq",value:function(t){var e=this.value();return e&&(t.type="giphy",t.giphy=e),t}},{key:"filterCanSubmit",value:function(t,e){return this.$postbox===e&&"giphy"===this.$postboxTab.current_tab_id&&t.hard.push(!!this.value()),t}},{key:"actionPostboxTypeSet",value:function(t,e){t===this.$postbox&&"giphy"===e&&"giphy"!==this.$postboxTab.current_tab_id&&this.$postbox.find("[data-tab=giphy]").trigger("click")}}]),i}();a.observer.addAction("peepso_postbox_addons",function(t){var e={init:function(){},set_postbox:function(t){t.find("[data-tab-id=giphy]").length&&new h(t)}};return t.push(e),t},10,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./giphy":2}]},{},[3]);