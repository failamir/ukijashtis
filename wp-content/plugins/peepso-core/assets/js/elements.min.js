!function o(i,a,d){function l(t,e){if(!a[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=a[t]={exports:{}},i[t][0].call(n.exports,function(e){return l(i[t][1][e]||e)},n,n.exports,o,i,a,d)}return a[t].exports}for(var s="function"==typeof require&&require,e=0;e<d.length;e++)l(d[e]);return l}({1:[function(e,t,n){!function(e){!function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;"undefined"!=typeof window||void 0!==e&&e.peepso;n.default=function(e,t){var n;e instanceof Element&&([t,n={}]=[e,t],t.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"}),t.addEventListener("drop",e=>{e.preventDefault();e=e.dataTransfer.files;e&&e.length&&"function"==typeof n.dropped&&n.dropped(e)}))}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,c){!function(p){!function(){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var e,t="undefined"!=typeof window?window.peepso:void 0!==p?p.peepso:null;const o=((e="undefined"!=typeof window?window.peepsodata:void 0!==p?p.peepsodata:null)&&e.__esModule?e:{default:e}).default.hashtags||{},a=o.url,i=+o.everything||0,d=!i&&+o.min_length||0,l=!i&&+o.max_length||1e4,s=!i&&+o.must_start_with_letter||0,r=(()=>{let e,t;return t=i?"(^|>|\\s)(#([^#\\s<]+))":"(^|>|\\s)(#("+((e=s)?"[a-z]":"")+"[a-z0-9]{"+Math.max(0,d-(e?1:0))+","+Math.max(0,l-(e?1:0))+"}))",new RegExp(t,"ig")})(),n=["a","area","audio","base","br","button","code","col","embed","frame","hr","iframe","img","input","keygen","link","meta","param","script","select","source","style","textarea","track","video","wbr"];function u(e){let t=e.querySelectorAll("*");t=[e,...t],t.forEach(e=>{if(!(-1<n.indexOf(e.tagName.toLowerCase()))){let i=[...e.childNodes];i.forEach(e=>{let t,n;var o;3===e.nodeType&&(t=e.textContent,t.trim()&&t.match(r)&&(n=document.createElement("div"),n.innerHTML=o=(o=t).match(r)?o.replace(r,function(e,t,n,o){return`${t}<a href="${a}${o}/"><span class="ps-stream-hashtag">${n}</span></a>`}):o,e.replaceWith.apply(e,n.childNodes),i=i.concat([...n.childNodes])))})}})}var f={init:function(){if(o.url){t.observer.addFilter("peepso_activity",e=>e.map(function(){if(1===this.nodeType){let e=this.querySelectorAll([".ps-js-activity-content",".ps-js-activity-extras",".ps-js-activity-quote",".ps-js-activity-background-text",".ps-comment__content"].join(", "));e.length||(e=[this]),e.forEach(u)}return this}),10,1),t.hooks.addAction("post_updated","hashtag",function(e){e=e.querySelector(".ps-js-activity-background-text");e&&u(e)});const n=(()=>{var e="(?:\\u200D\\u200D)",t=`((?:^|\\s|&nbsp;)${e}?)`;let n;return n=i?`${t}(#${e}?(?:[^#\\s\\u200D]${e}?)+)`:`${t}(#${e}?(?:${(t=s)?`[a-z]${e}?`:""}(?:[a-z0-9]${e}?){${Math.max(0,d-(t?1:0))},${Math.max(0,l-(t?1:0))}})+)`,new RegExp(n,"ig")})();t.observer.addAction("postbox_content_transform",(e,t)=>{let o=n;[...e.querySelectorAll("[data-hashtag]")].forEach(e=>{var t=[...e.childNodes].find(e=>e.nodeType===Node.TEXT_NODE);let n=e.previousSibling,o=e.nextSibling;n&&n.nodeType===Node.TEXT_NODE?(n.textContent+=t.textContent,e.remove(),o&&o.nodeType===Node.TEXT_NODE&&(n.textContent+=o.textContent,o.remove())):o&&o.nodeType===Node.TEXT_NODE?(o.textContent=t.textContent+o.textContent,e.remove()):e.replaceWith.apply(e,[t])}),function e(t){[...t.childNodes].forEach(n=>{if(Node.TEXT_NODE===n.nodeType){let t=n.textContent;if(t.match(o)){let e=document.createElement("div");e.innerHTML=t.replace(o,(e,t,n)=>{let o=n;return`${t}<span data-highlight data-hashtag data-value="${o.replace(/\u200D/gi,"")}">${o}</span>`}),n.replaceWith.apply(n,e.childNodes)}}else Node.ELEMENT_NODE===n.nodeType&&e(n)})}(e)},10,2),jQuery(".peepso-wp-post-hashtags").each(function(){u(this)})}}};c.default=f}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(r,e,t){!function(s){!function(){"use strict";var e=l("undefined"!=typeof window?window.jQuery:void 0!==s?s.jQuery:null),t=l("undefined"!=typeof window?window.peepso:void 0!==s?s.peepso:null),n=l(r("./droppable")),o=l(r("./post")),i=l(r("./hashtag")),a=l(r("./mention")),d=l(r("./permalink"));function l(e){return e&&e.__esModule?e:{default:e}}t.default.elements={droppable:n.default},(0,e.default)(function(){o.default.init(),i.default.init(),a.default.init(),d.default.init()})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./droppable":1,"./hashtag":2,"./mention":4,"./permalink":5,"./post":7}],4:[function(e,t,f){!function(u){!function(){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default=void 0;var e,h=(e="undefined"!=typeof window?window.jQuery:void 0!==u?u.jQuery:null)&&e.__esModule?e:{default:e},m="undefined"!=typeof window?window.peepso:void 0!==u?u.peepso:null;const i=/@peepso_([a-z]+)_(\d+)(?:\(([^\)]+)\))?/g,n=["a","area","audio","base","br","button","code","col","embed","frame","hr","iframe","img","input","keygen","link","meta","param","script","select","source","style","textarea","track","video","wbr"];let a=0;function d(e){return e=e.match(i)?e.replace(i,function(e,t,n,o){var i=`ps-tag__link ps-js-mention-${++a}`,e=`<a class="${i}">${o||e}</a>`;return i=i,o=[t,n,o],s?r.push({elements:i,params:o}):l(i,o),e}):e}function t(e){let t=e.querySelectorAll("*");t=[e,...t],t.forEach(e=>{if(!(-1<n.indexOf(e.tagName.toLowerCase()))){let o=[...e.childNodes];o.forEach(e=>{let t,n;3===e.nodeType&&(t=e.textContent,t.trim()&&t.match(i)&&(n=document.createElement("div"),n.innerHTML=d(t),e.replaceWith.apply(e,n.childNodes),o=o.concat([...n.childNodes])))})}})}function l(e,t){var[n,o,t]=t;m.modules.mention.getHtml(n,o,t).then(n=>{(e=[...document.getElementsByClassName(e)]).forEach(t=>{let e=document.createElement("div");e.innerHTML=n,[...e.childNodes].forEach(e=>{t.parentNode.insertBefore(e,t)}),t.parentNode.removeChild(t)})})}let s=!0,r=[];let v;function y(){v&&v.hide()}m.observer.addAction("postbox_content_change",(n,o)=>{let e=window.getSelection();if(!e.rangeCount)return!1;var i=e.getRangeAt(0);let a=i.startContainer;if(a.nodeType===Node.TEXT_NODE){let e=a.parentElement;if(e.hasAttribute("data-mention"))!function(a){let e=a.getAttribute("data-name"),i=a.innerText;if(i!==e){let t=e.split(/\s+/),o=i.split(/\s+/);if(o=o.filter(e=>0<=t.indexOf(e)),o.length){let e=a.childNodes[0];i=o.join(" "),e.textContent=i,a.setAttribute("data-value",`@peepso_user_${a.getAttribute("data-id")}(${i})`);let t=window.getSelection(),n=document.createRange();n.setStart(e,e.textContent.length),n.collapse(!0),t.removeAllRanges(),t.addRange(n)}else{let e=a.previousSibling,t=a.nextSibling,n,o;e?(n=e,o=e.textContent.length,t&&(e.textContent+=t.textContent,t.remove())):t&&(n=t,o=0);let i=a.parentElement;if(a.remove(),n){let e=window.getSelection(),t=document.createRange();t.setStart(n,o),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}i.innerText.trim().length||(i.innerHTML="",i.focus())}}}(e);else{let e=a.textContent.substr(0,i.startOffset);let t=e.match(/@([a-z]+)$/i);t?function(d,l,s){v||(v=(0,h.default)('<div class="ps-post__background-selector" />'),v.appendTo(document.body));let f=window.getSelection();if(f.rangeCount){let e=f.getRangeAt(0),r=e.startContainer,u=e.startOffset,t=e.getClientRects()[0],n=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft,i=t.top+n+25,a=t.left+o;function p(){if(v&&v.is(":visible")){let d=v.find(".active");if(d.length){let e=r.textContent,t=e.substr(0,u),n=e.substr(u);t=t.replace(/@[^@]*$/,""),n=n.replace(/^[^\s]+/,"");let o=document.createElement("div");var l=d.data("id"),s=d.data("name");o.innerHTML=`${t}<span data-highlight data-mention data-id="${l}" data-name="${s}" data-value="${`@peepso_user_${l}(${s})`}">${s}</span> \u200D${n}`;s=o.childNodes[t.length?2:1];r.replaceWith.apply(r,o.childNodes);let i=window.getSelection(),a=document.createRange();a.setStart(s,1),a.collapse(!0),i.removeAllRanges(),i.addRange(a),y()}}}function c(n="down"){if(v){let e=v.find(".active"),t="up"===n?e.prev():e.next();t.length||(t="up"===n?e.siblings().last():e.siblings().first()),t.length&&(e.removeClass("active"),t.addClass("active"))}}l.disableInput=!0,v.css({top:i,left:a}),v.show(),v.off("click.ps-mention"),v.on("click.ps-mention",function(e){let t=(0,h.default)(e.target).closest("[data-item]");t.length&&(e.preventDefault(),e.stopPropagation(),t.addClass("active").siblings("[data-item]").removeClass("active"),p(),setTimeout(()=>l.disableInput=!1,400))}),(0,h.default)(d).off("keydown.ps-mention"),(0,h.default)(d).on("keydown.ps-mention",function(e){var t=e.keyCode;13===t?(e.preventDefault(),e.stopPropagation(),p(),setTimeout(()=>l.disableInput=!1,400)):27===t?(y(),setTimeout(()=>l.disableInput=!1,400)):38===t?(e.preventDefault(),e.stopPropagation(),c("up")):40===t&&(e.preventDefault(),e.stopPropagation(),c("down"))}),m.modules.mention.getTargets().then(t=>{let n="",o=0,e=[...d.querySelectorAll("[data-mention]")];e=e.map(e=>+e.getAttribute("data-id"));for(const a in t.users)if(!(0<=e.indexOf(+a))&&Object.hasOwnProperty.call(t.users,a)){var i=t.users[a];let e=i.name;String.prototype.normalize&&(e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")),0<=e.toLowerCase().indexOf(s)&&(n+=`<a href="#" class="${o++?"":"active"}" data-item data-id="${i.id}" data-name="${i.name}" style="display: block; white-space: nowrap"><div class="ps-avatar"><img src="${i.avatar}"></div> <span>${i.name}</span></a>`)}n?v.html(n):v.hide()})}}(n,o,t.slice(1)):y()}}},10,2),m.observer.addAction("postbox_content_update",(e,t)=>{[...[...e.childNodes].filter(e=>e.nodeType===Node.TEXT_NODE)].forEach(t=>{var n=t.textContent.replace(/@peepso_user_(\d+)\(([\s\S]*?)\)/g,function(e,t,n){return`<span data-highlight data-mention data-id="${t}" data-name="${n}" data-value="${e}">${n}</span>`});if(n!==t.textContent){let e=document.createElement("div");e.innerHTML=n,t.replaceWith.apply(t,e.childNodes)}})},10,2);var o={init:function(){m.observer.addFilter("peepso_activity",e=>e.map(function(){return 1===this.nodeType&&t(this),this}),10,1),m.hooks.addAction("post_updated","mention",function(e){e=e.querySelector(".ps-js-activity-background-text");e&&t(e)}),(0,h.default)(()=>{t(document.body),setTimeout(()=>{for(s=!1;r.length;){var{elements:e,params:t}=r.shift();l(e,t)}},3e3)})}};f.default=o}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,a){!function(i){!function(){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e,o=(e="undefined"!=typeof window?window.jQuery:void 0!==i?i.jQuery:null)&&e.__esModule?e:{default:e},t="undefined"!=typeof window?window.peepso:void 0!==i?i.peepso:null;function n(){(0,o.default)(".ps-js-permalink").each(function(){let e=(0,o.default)(this);e.removeClass("ps-js-permalink"),e.on("click",function(e){e.preventDefault(),e.stopPropagation();let t=(0,o.default)(this),n=t.closest("a[href]");n.length&&(peepso.util.copyToClipboard(n.attr("href")),t.attr("data-tooltip",t.data("tooltip-success")))}),e.on("mouseleave",function(){let e=(0,o.default)(this),t=e.data("tooltip-initial");t!==e.attr("data-tooltip")&&e.attr("data-tooltip",t)})})}a.default={init:function(){(0,o.default)(function(){setTimeout(n,1e3)}),t.observer.addFilter("peepso_activity",e=>(setTimeout(n,1e3),e),10,1)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,o){!function(t){!function(){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e,a=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},d="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null,i="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;function n(e,t){let n=(0,a.default)(e);if(!t){let e=n.find(".ps-js-post-body input[name=peepso_set_human_friendly]");e.length&&(t=e.val(),e.remove())}+t&&(+i.is_admin||+n.data("author")==+i.currentuserid)&&d.modules.post.setHumanReadable(+t,function(e){let t=(0,a.default)(e),n=t.find(".ps-js-post-body .ps-js-activity-background-text");n.length||(n=t.find(".ps-js-post-body .ps-js-activity-content"));let o=n.get(0).innerText.trim(),i=d.observer.applyFilters("human_friendly_extras",[],o,e);return i.length&&(o&&i.unshift(o),o=i.join(". ")),o||(n=t.find(".ps-js-post-header .ps-stream-action-title"),n.length&&(o=n.get(0).innerText.trim())),o=o.replace(/\r?\n/g," "),o}(e));let o=n.find(".ps-js-comment-item");o.length&&o.each(function(){l(this)})}function l(e,t){let n=(0,a.default)(e);if(!t){let e=n.find(".ps-js-comment-body").eq(0).find("input[name=peepso_set_human_friendly]");e.length&&(t=e.val(),e.remove())}+t&&(+i.is_admin||+n.data("author")==+i.currentuserid)&&d.modules.post.setHumanReadable(+t,function(e){let t=(0,a.default)(e),n=t.find(".ps-js-comment-body .ps-js-comment-content"),o=n.get(0).innerText.trim(),i=d.observer.applyFilters("human_friendly_extras",[],o,e);return i.length&&(o&&i.unshift(o),o=i.join(". ")),o=o.replace(/\r?\n/g," "),o}(e))}d.hooks.addAction("post_added","human_readable",n),d.hooks.addAction("post_updated","human_readable",function(e){var t=(0,a.default)(e).data("post-id");t&&n(e,t)}),d.hooks.addAction("comment_added","human_readable",l),d.hooks.addAction("comment_updated","human_readable",function(e){var t=(0,a.default)(e).data("comment-id");t&&l(e,t)}),o.default={init:function(){}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=l(e("./save")),i=l(e("./track")),a=l(e("./human")),d=l(e("./link-target"));function l(e){return e&&e.__esModule?e:{default:e}}n.default={init:function(){o.default.init(),i.default.init(),a.default.init(),d.default.init()}}},{"./human":6,"./link-target":8,"./save":9,"./track":10}],8:[function(e,t,n){!function(t){!function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e,o=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},i="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null;n.default={init:function(){i.observer.addFilter("peepso_activity_content",e=>function(e){let t=(0,o.default)("<div/>").append(e),n;return n=t.find(".ps-js-post-body").length?t.find(".ps-js-post-body a[href]"):t.find(".ps-js-comment-body").length?t.find(".ps-js-comment-content a[href]").add(t.find(".ps-js-comment-attachment a[href]")):t.find("a[href]"),n.each(function(){let e=(0,o.default)(this),t=i.modules.url.getTarget(e.attr("href"),!1);t?e.attr("target",t):e.removeAttr("target")}),t.html()}(e),10,1)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,h){!function(c){!function(){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var e,i=(e="undefined"!=typeof window?window.jQuery:void 0!==c?c.jQuery:null)&&e.__esModule?e:{default:e},a="undefined"!=typeof window?window.peepso:void 0!==c?c.peepso:null,t="undefined"!=typeof window?window.peepsodata:void 0!==c?c.peepsodata:null;t=t.elements&&t.elements.post||{};const d=t.text_save,l=t.text_saved,s=t.html_saved_notice;let r=null;function u(e){e.style.opacity=.3,e.removeEventListener("click",n)}function f(e,t={}){e.style.opacity="",e.addEventListener("click",n),+t.saved&&e.setAttribute("data-object-id",t.id)}function p(e,t){let n=e.querySelector("i"),o=e.querySelector("span");t?(e.setAttribute("data-saved","1"),n.className="gcis gci-bookmark",o.innerHTML=l):(e.removeAttribute("data-saved"),n.className="gcir gci-bookmark",o.innerHTML=d)}function n(e){let o=e.currentTarget,t=+o.getAttribute("data-saved"),n=+o.getAttribute(t?"data-object-id":"data-stream-id");e.preventDefault(),e.stopPropagation(),u(o),p(o,!t),a.modules.post.save(n,!t).then(function(e){let t=!1;var n;f(o,e),e.saved&&(t=a.observer.applyFilters("post_saved_notice",!0)),t?(n=(0,i.default)(o).offset(),e=(0,i.default)(o).height(),r||(r=(0,i.default)("<div/>").html(s),r.css({position:"absolute"}),r.appendTo(document.body)),r.stop().show(),r.css({top:Math.round(n.top-r.height()/2+e/2),left:Math.round(n.left-r.width()-10)}),r.delay(2e3).fadeOut()):r&&r.stop().hide()})}function o(e){let t=e.querySelector(".ps-js-save-toggle");t&&(u(t),(e=+t.getAttribute("data-stream-id"))&&a.modules.post.save(e).then(function(e){f(t,e),p(t,!!e.saved)}))}h.default={init:function(){a.observer.addFilter("peepso_activity",e=>e.map(function(){return 1===this.nodeType&&function(e){let t=e.querySelector(".js-stream-actions");if(t){let e=t.querySelector(".ps-js-save-toggle");e&&(!e.closest||e.closest(".ps-js-activity")?o(t):e.remove())}}(this),this}),10,1),a.observer.addAction("peepso_activity_actions",e=>{e.map(function(){return 1===this.nodeType&&o(this),this})},10,1)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(e,t,s){!function(l){!function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var e,o=(e="undefined"!=typeof window?window.jQuery:void 0!==l?l.jQuery:null)&&e.__esModule?e:{default:e},t="undefined"!=typeof window?window._:void 0!==l?l._:null,i="undefined"!=typeof window?window.peepso:void 0!==l?l.peepso:null,n="undefined"!=typeof window?window.peepsodata:void 0!==l?l.peepsodata:null;let a=[],d=(0,t.debounce)(function(){if(a.length)for(let t=a.length-1;0<=t;t--){var n=a[t];if(i.util.isElementPartlyInViewport(n)){let e=(0,o.default)(n).closest(".ps-js-activity");e.length&&(n=e.data("id"),i.modules.post.trackView(n)),a.splice(t,1)}}},1e3);t={init:function(){+n.currentuserid&&((0,o.default)(window).on("scroll",d),i.observer.addFilter("peepso_activity",e=>e.map(function(){var e;return 1===this.nodeType&&(e=this,a.push(e),d()),this}),10,1))}};s.default=t}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);